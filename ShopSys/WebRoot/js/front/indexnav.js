$(function(){var categoryIds=new Array();var categoryPageUrls=new Array();var categoryNames=new Array();var categoryPlace=new Array();var startCategoryPlace=252;$.ajaxSettings.async=false;$.ajax({url:"/ShopSys/productmanage/categoryAction_frontLoadCategory.action",type:"post",dataType:"json",success:function(data){var categories=data.categories;localStorage.categories=JSON.stringify(categories);var navli="";for(var i=0;i<categories.length;i++){categoryPlace[i]=startCategoryPlace+(categories[i].categoryName.length*16+50)/2;startCategoryPlace=startCategoryPlace+categories[i].categoryName.length*16+50;navli=navli+"<li data-navPlace='C"+categories[i].id+"'>"+"<h2>"+"<a href='"+categories[i].pageUrl+"_C"+categories[i].id+"' onclick=\"changeTitle('"+categories[i].categoryName+"',"+categories[i].id+",0,'"+categories[i].pageUrl+"_C"+categories[i].id+"')\">"+categories[i].categoryName+"</a>"+"</h2>"+"</li>";categoryIds.push(categories[i].id);categoryPageUrls.push(categories[i].pageUrl);categoryNames.push(categories[i].categoryName)}$("#headnav li:last").after(navli)}});var ids=categoryIds.join(",");initialKinds(ids,categoryIds,categoryPageUrls,categoryNames,categoryPlace);$.ajaxSettings.async=true;var qcloud={};$("[data-navPlace]").hover(function(){var _nav=$(this).attr("data-navPlace");clearTimeout(qcloud[_nav+"_timer"]);qcloud[_nav+"_timer"]=setTimeout(function(){$("[data-navPlace]").each(function(){$(this)[_nav==$(this).attr("data-navPlace")?"addClass":"removeClass"]("nav-up-selected")});$("#"+_nav).slideDown(200)},150)},function(){var _nav=$(this).attr("data-navPlace");clearTimeout(qcloud[_nav+"_timer"]);qcloud[_nav+"_timer"]=setTimeout(function(){$("[data-navPlace]").removeClass("nav-up-selected");$("#"+_nav).slideUp(200)},150)});$("[data-navPlace]").click(function(){var _nav=$(this).attr("data-navPlace");$("[data-navPlace]").removeClass("nav-up-selected-inpage");$("[data-navPlace='"+_nav+"']").addClass("nav-up-selected-inpage")})});function initialKinds(ids,categoryIds,categoryPageUrls,categoryNames,categoryPlace){$.ajax({url:"/ShopSys/productmanage/kindAction_frontLoadKindByIds.action",type:"post",dataType:"json",data:{"id":ids},success:function(data){var rows=data.rows;localStorage.kinds=JSON.stringify(rows);var childNav="";var kindsLength=new Array();for(var i=0;i<rows.length;i++){var list=rows[i].list;var dls="";kindsLength[i]=0;for(var j=0;j<list.length;j++){var catePageUrl=categoryPageUrls[i];if(list[j].pageUrl!=""){catePageUrl=list[j].pageUrl}if(j==0){dls=dls+"<dd>"+"<a href='"+catePageUrl+"_K"+list[j].id+"' onclick=\"changeTitle('"+categoryNames[i]+"',"+categoryIds[i]+","+list[j].id+",'"+catePageUrl+"_K"+list[j].id+"')\">"+list[j].kindName+"</a>"+"</dd>"+"</dl>"}else{dls=dls+"<dl>"+"<dd>"+"<a href='"+catePageUrl+"_K"+list[j].id+"' onclick=\"changeTitle('"+categoryNames[i]+"',"+categoryIds[i]+","+list[j].id+",'"+catePageUrl+"_K"+list[j].id+"')\">"+list[j].kindName+"</a>"+"</dd>"+"</dl>"}kindsLength[i]=kindsLength[i]+list[j].kindName.length*14+80}var marginPlace=computePlace(kindsLength[i],categoryPlace[i]);if(kindsLength[i]>0){childNav=childNav+"<div class='navigation-down'>"+"<div id='"+rows[i].cn+"' class='nav-down-menu menu-1' style='display: none;' data-navPlace='"+rows[i].cn+"'>"+"<div class='navigation-down-inner'> <dl style='margin-left: "+marginPlace+"px;'>"+dls+"</div></div></div>"}}$(".navigation-down:last").after(childNav)}})}function computePlace(kindLength,categoryPlace){var marginPlace=0;var left=categoryPlace;var right=1170-categoryPlace;var halfLength=kindLength/2;if(kindLength>=1170){marginPlace=20}else{if(halfLength<=left&&halfLength<=right){marginPlace=left-halfLength+60}else{if(halfLength>left&&halfLength<right){marginPlace=90}else{if(halfLength<left&&halfLength>right){marginPlace=1170-kindLength}else{marginPlace=20}}}}return marginPlace}function getImageUrl(){var hostname=window.location.hostname;var protocal=window.location.protocol;var port=window.location.port;var imagesUrl=protocal+"//"+hostname+":"+port+"/images";return imagesUrl};